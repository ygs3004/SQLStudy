-- 13-1 데이터 사전 보기
SELECT * FROM DICT;

-- 13-2 데이터 사전 보기 2
SELECT * FROM DICTIONARY;

-- 13-3 USER_  => 현재 접속해 있는 사용자 소유 객체정보
SELECT TABLE_NAME
    FROM USER_TABLES; -- TABLE이 아닌 TABLES임
    
SELECT * FROM TAB;

-- 13-4 ALL_ => 허락되어 있는 다른 사용자 객체 정보까지
SELECT OWNER, TABLE_NAME 
    FROM ALL_TABLES;
    
-- 13-5, 13-6 SCOTT 계정으로 확인 불가, SYSTEM 계정으로 확인 DBA->  데이터베이스 관리 권한을 가진 사용자만 조회 가능
SELECT *FROM DBA_TABLES; -- SYSTEM 계정만 조회 가능

-- 13-7 사용자 정보보기
SELECT * FROM DBA_USERS
    WHERE USERNAME = 'SCOTT';
    
-- 13-8 인덱스 정보 보기 -> 인덱스를 통해 더 빠른 검색 가능
SELECT * 
    FROM USER_INDEXES;
    
-- 13-9 SCOTT이 소유한 인덱스 컬럼 정보 알아보기
SELECT *
    FROM USER_IND_COLUMNS;
    
-- 13-10 열에 INDEX 생성
CREATE INDEX IDX_EMP_SAL
    ON EMP(SAL);  -- 설정 안할시 ASC 순으로 정렬
    
-- 13-11 생성된 INDEX 조회
SELECT * 
    FROM  USER_IND_COLUMNS;
    
-- 13-12 INDEX 삭제
DROP INDEX IDX_EMP_SAL;

-- 13-13 INDEX 조회
SELECT * FROM USER_IND_COLUMNS;  

-- 13-14 뷰 권한 주기
SQLPLUS SYSTEM/ORACLE -- SQL*PLUS에서 

GRANT CREATE VIEW TO SCOTT; --뷰 권한 주기

-- 13-15 CREATE VIEW
CREATE VIEW VW_EMP20
    AS (SELECT EMPNO, ENAME, JOB, DEPTNO
            FROM EMP
            WHERE DEPTNO=20);
            
-- 13-16 VIEW 생성 확인
SELECT  *
    FROM USER_VIEWS;
    
-- 13-17 VIEW 확인
SELECT VIEW_NAME, TEXT_LENGTH, TEXT
    FROM USER_VIEWS;

-- 13-18 VIEW 조회
SELECT *
    FROM VW_EMP20;
    
-- 13-19 VIEW 제거
DROP VIEW VW_EMP20;

-- 13-20 ROWNUM, 인라인 뷰 이용(일회성 뷰)
SELECT ROWNUM, E.*
    FROM EMP E;
    
-- 13-21 정렬 하여 조회 (ROWNUM은 정렬 전에 매겨짐을 확인 가능)
SELECT ROWNUM, E.*
    FROM EMP E
    ORDER BY SAL DESC;

-- 13-22 ORDER BY 이후의 ROWNUM 설정 인라인 뷰
SELECT ROWNUM, E.*
    FROM (SELECT * 
                FROM EMP E 
                ORDER BY SAL DESC) E;
                
-- 13-23 WITH 이용
WITH E AS (SELECT * FROM EMP ORDER BY SAL DESC)
SELECT ROWNUM, E.*
    FROM E;
    
-- 13-24 TOP-N 추출하기
SELECT ROWNUM, E.*
    FROM (SELECT *
                FROM EMP
                ORDER BY SAL DESC) E
    WHERE ROWNUM <= 3;
    
-- 13-25 TOP-N 추출 (WITH절)
WITH E AS (SELECT * FROM EMP ORDER BY SAL DESC)
SELECT ROWNUM, E.*
 FROM E
 WHERE ROWNUM <= 3;
 
-- 13-26 SEQUENCE 실습용 테이블 복사
 CREATE TABLE DEPT_SEQUENCE
    AS SELECT *
        FROM DEPT
        WHERE 1<> 1;

SELECT * FROM DEPT_SEQUENCE;

-- 13-7 SEQUENCE 생성
CREATE SEQUENCE SEQ_DEPT_SEQUENCE
    INCREMENT BY 10
    START WITH 10
    MAXVALUE 90
    MINVALUE 0
    NOCYCLE
    CACHE 2;

-- 13-8 SEQUENCE 조회
SELECT *
    FROM USER_SEQUENCES;
    
-- 13-29 SEQUENCE 사용
INSERT INTO DEPT_SEQUENCE (DEPTNO, DNAME, LOC) VALUES(SEQ_DEPT_SEQUENCE.NEXTVAL, 'DATABASE', 'SEOUL');

-- 13-30 마지막 사용 SEQUENCE 값 확인
SELECT SEQ_DEPT_SEQUENCE.CURRVAL
    FROM DUAL;
    
-- 13-31 SEQUENCE INSERT 반복 90이후 오류(MAXVALUE 설정했기 때문에)
INSERT INTO DEPT_SEQUENCE(DEPTNO, DNAME, LOC)
VALUES(SEQ_DEPT_SEQUENCE.NEXTVAL, 'DATABASE', 'SEOUL');

SELECT * FROM DEPT_SEQUENCE ORDER BY DEPTNO;

-- 13-32 SEQUENCE 수정
ALTER SEQUENCE SEQ_DEPT_SEQUENCE
    INCREMENT BY 3
    MAXVALUE 99
    CYCLE;
    
-- 13-33 SEQUENCE 조회
SELECT * 
    FROM USER_SEQUENCES;
    
-- 13-34, 13-35 수정한 시퀀스를 사용하여 INSERT, 반복하여 최대(99)까지, 넘어갈 경우 CYCLE
INSERT INTO DEPT_SEQUENCE(DEPTNO, DNAME, LOC)
VALUES(SEQ_DEPT_SEQUENCE.NEXTVAL, 'DATABASE', 'SEOUL');

SELECT * FROM DEPT_SEQUENCE ORDER BY DEPTNO;

-- 13-36 SEQUENCE 삭제 , DROP
DROP SEQUENCE SEQ_DEPT_SEQUENCE;

SELECT * FROM USER_SEQUENCES;

-- 13-37 SYNONYM 동의어 권한 부여 필요(SYSTEM 계정 필요)
SQLPLUS SYSTEM/oracle

GRANT CREATE SYNONYM TO SCOTT;

GRANT CREATE PUBLIC SYNONYM TO SCOTT;

-- 13-38 EMP SYNONYM 생성
CREATE SYNONYM E
    FOR EMP;

-- 13-39 E 테이블 조회
SELECT * FROM E;

-- 13-40 SYNONYM 삭제
DROP SYNONYM E;